#include <stdio.h>
#include <stdlib.h>
#include <fcntl.h>
#include <unistd.h>
#include <sys/mman.h>
#include <sys/types.h>
#include <sys/stat.h>

int lcdfd;
int *plcd;

char num_code[10][144] =
    {
        {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7C, 0x00, 0x01, 0xFF, 0x00, 0x03, 0xEF,
         0xC0, 0x07, 0xC3, 0xC0, 0x0F, 0x81, 0xE0, 0x0F, 0x01, 0xF0, 0x1F, 0x00, 0xF0, 0x1F, 0x00, 0xF8,
         0x3E, 0x00, 0xF8, 0x3E, 0x00, 0xF8, 0x3E, 0x00, 0x7C, 0x3E, 0x00, 0x7C, 0x3E, 0x00, 0x7C, 0x7C,
         0x00, 0x7C, 0x7C, 0x00, 0x7C, 0x7C, 0x00, 0x7C, 0x7C, 0x00, 0x7C, 0x7C, 0x00, 0x7C, 0x7C, 0x00,
         0x7C, 0x7C, 0x00, 0x7C, 0x7E, 0x00, 0x7C, 0x3E, 0x00, 0x7C, 0x3E, 0x00, 0x7C, 0x3E, 0x00, 0x78,
         0x3E, 0x00, 0xF8, 0x3E, 0x00, 0xF8, 0x1F, 0x00, 0xF8, 0x1F, 0x00, 0xF0, 0x0F, 0x01, 0xF0, 0x0F,
         0x81, 0xE0, 0x07, 0xC3, 0xC0, 0x03, 0xFF, 0x80, 0x01, 0xFF, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0C, 0x00, 0x00, 0x1C, 0x00, 0x00, 0x3C,
         0x00, 0x0F, 0xFC, 0x00, 0x0F, 0xFC, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00,
         0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00,
         0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C,
         0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00,
         0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x3C, 0x00, 0x00,
         0x3C, 0x00, 0x00, 0x7E, 0x00, 0x07, 0xFF, 0xE0, 0x0F, 0xFF, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7E, 0x00, 0x03, 0xFF, 0xC0, 0x07, 0xC7,
         0xE0, 0x0F, 0x01, 0xF0, 0x1E, 0x00, 0xF0, 0x1E, 0x00, 0xF8, 0x3E, 0x00, 0xF8, 0x3E, 0x00, 0xF8,
         0x3F, 0x00, 0xF8, 0x3F, 0x00, 0xF8, 0x3F, 0x00, 0xF8, 0x0E, 0x00, 0xF8, 0x00, 0x00, 0xF0, 0x00,
         0x01, 0xF0, 0x00, 0x01, 0xE0, 0x00, 0x03, 0xE0, 0x00, 0x07, 0xC0, 0x00, 0x07, 0x80, 0x00, 0x0F,
         0x00, 0x00, 0x1E, 0x00, 0x00, 0x3C, 0x00, 0x00, 0x78, 0x00, 0x00, 0xF0, 0x00, 0x01, 0xE0, 0x00,
         0x03, 0xC0, 0x00, 0x07, 0x80, 0x18, 0x0F, 0x00, 0x18, 0x0E, 0x00, 0x38, 0x1C, 0x00, 0x38, 0x38,
         0x00, 0xF8, 0x3F, 0xFF, 0xF8, 0x7F, 0xFF, 0xF8, 0x7F, 0xFF, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7C, 0x00, 0x03, 0xFF, 0x00, 0x07, 0x8F,
         0xC0, 0x0E, 0x03, 0xE0, 0x1E, 0x01, 0xE0, 0x1E, 0x01, 0xF0, 0x3E, 0x01, 0xF0, 0x3F, 0x00, 0xF0,
         0x1F, 0x00, 0xF0, 0x0E, 0x00, 0xF0, 0x00, 0x01, 0xF0, 0x00, 0x01, 0xF0, 0x00, 0x01, 0xE0, 0x00,
         0x03, 0xC0, 0x00, 0x0F, 0x80, 0x00, 0xFE, 0x00, 0x00, 0xFF, 0x80, 0x00, 0x07, 0xC0, 0x00, 0x01,
         0xE0, 0x00, 0x00, 0xF0, 0x00, 0x00, 0xF8, 0x00, 0x00, 0xF8, 0x00, 0x00, 0x78, 0x00, 0x00, 0x7C,
         0x1E, 0x00, 0x7C, 0x3E, 0x00, 0x78, 0x3F, 0x00, 0x78, 0x3F, 0x00, 0xF8, 0x3E, 0x00, 0xF8, 0x3E,
         0x01, 0xF0, 0x1E, 0x03, 0xE0, 0x0F, 0x8F, 0xC0, 0x03, 0xFF, 0x80, 0x00, 0xFC, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0xC0, 0x00, 0x03, 0xC0, 0x00, 0x07,
         0xC0, 0x00, 0x07, 0xC0, 0x00, 0x0F, 0xC0, 0x00, 0x1F, 0xC0, 0x00, 0x1F, 0xC0, 0x00, 0x3F, 0xC0,
         0x00, 0x7F, 0xC0, 0x00, 0x77, 0xC0, 0x00, 0xE7, 0xC0, 0x00, 0xE7, 0xC0, 0x01, 0xC7, 0xC0, 0x03,
         0x87, 0xC0, 0x03, 0x87, 0xC0, 0x07, 0x07, 0xC0, 0x0F, 0x07, 0xC0, 0x0E, 0x07, 0xC0, 0x1C, 0x07,
         0xC0, 0x1C, 0x07, 0xC0, 0x38, 0x07, 0xC0, 0x70, 0x07, 0xC0, 0x7F, 0xFF, 0xFE, 0x7F, 0xFF, 0xFC,
         0x00, 0x07, 0xC0, 0x00, 0x07, 0xC0, 0x00, 0x07, 0xC0, 0x00, 0x07, 0xC0, 0x00, 0x07, 0xC0, 0x00,
         0x07, 0xC0, 0x00, 0x07, 0xC0, 0x00, 0x7F, 0xFC, 0x00, 0xFF, 0xFC, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0xFF, 0xF8, 0x0F, 0xFF,
         0xF8, 0x0F, 0xFF, 0xF0, 0x0E, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x0E, 0x00, 0x00,
         0x0E, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x0C, 0x00, 0x00, 0x1C, 0x7F, 0x00, 0x1D,
         0xFF, 0xC0, 0x1F, 0xFF, 0xE0, 0x1F, 0x83, 0xF0, 0x1E, 0x01, 0xF0, 0x1E, 0x00, 0xF8, 0x04, 0x00,
         0xF8, 0x00, 0x00, 0x78, 0x00, 0x00, 0x78, 0x00, 0x00, 0x7C, 0x00, 0x00, 0x7C, 0x0C, 0x00, 0x7C,
         0x1E, 0x00, 0x78, 0x3F, 0x00, 0x78, 0x3F, 0x00, 0x78, 0x3E, 0x00, 0xF8, 0x3E, 0x00, 0xF0, 0x1E,
         0x01, 0xF0, 0x1E, 0x03, 0xE0, 0x0F, 0xC7, 0xC0, 0x03, 0xFF, 0x80, 0x00, 0x7C, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0xFF, 0xC0, 0x01, 0xF1,
         0xE0, 0x03, 0xC1, 0xF0, 0x07, 0x81, 0xF0, 0x0F, 0x01, 0xF0, 0x0F, 0x01, 0xF0, 0x1E, 0x00, 0x00,
         0x1E, 0x00, 0x00, 0x3E, 0x00, 0x00, 0x3E, 0x00, 0x00, 0x3E, 0x00, 0x00, 0x3E, 0x1F, 0x00, 0x3C,
         0xFF, 0xC0, 0x7D, 0xFF, 0xE0, 0x7F, 0xC1, 0xF0, 0x7F, 0x80, 0xF8, 0x7F, 0x00, 0xF8, 0x7E, 0x00,
         0x7C, 0x7E, 0x00, 0x7C, 0x7C, 0x00, 0x7C, 0x7C, 0x00, 0x7C, 0x3C, 0x00, 0x7C, 0x3E, 0x00, 0x7C,
         0x3E, 0x00, 0x7C, 0x3E, 0x00, 0x7C, 0x3E, 0x00, 0x7C, 0x1F, 0x00, 0x78, 0x1F, 0x00, 0x78, 0x0F,
         0x80, 0xF0, 0x07, 0xC1, 0xF0, 0x03, 0xE3, 0xE0, 0x01, 0xFF, 0x80, 0x00, 0x3E, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0xFF, 0xFC, 0x1F, 0xFF,
         0xFC, 0x1F, 0xFF, 0xF8, 0x1E, 0x00, 0x70, 0x1C, 0x00, 0x70, 0x3C, 0x00, 0xE0, 0x38, 0x00, 0xE0,
         0x38, 0x01, 0xC0, 0x00, 0x01, 0xC0, 0x00, 0x03, 0x80, 0x00, 0x07, 0x80, 0x00, 0x07, 0x00, 0x00,
         0x07, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x0E, 0x00, 0x00, 0x1E, 0x00, 0x00, 0x1C, 0x00, 0x00, 0x3C,
         0x00, 0x00, 0x3C, 0x00, 0x00, 0x7C, 0x00, 0x00, 0x78, 0x00, 0x00, 0x78, 0x00, 0x00, 0x78, 0x00,
         0x00, 0xF8, 0x00, 0x00, 0xF8, 0x00, 0x00, 0xF8, 0x00, 0x00, 0xF8, 0x00, 0x00, 0xF8, 0x00, 0x00,
         0xF8, 0x00, 0x00, 0xF8, 0x00, 0x00, 0xF8, 0x00, 0x00, 0xF8, 0x00, 0x00, 0x70, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7E, 0x00, 0x03, 0xFF, 0x80, 0x07, 0xC3,
         0xE0, 0x0F, 0x01, 0xF0, 0x1E, 0x00, 0xF0, 0x3C, 0x00, 0x78, 0x3C, 0x00, 0x78, 0x3C, 0x00, 0x78,
         0x3C, 0x00, 0x78, 0x3C, 0x00, 0x78, 0x3E, 0x00, 0x78, 0x1F, 0x00, 0x78, 0x1F, 0x80, 0xF0, 0x0F,
         0xE1, 0xE0, 0x07, 0xFB, 0xC0, 0x03, 0xFF, 0x80, 0x03, 0xFF, 0x80, 0x07, 0xBF, 0xC0, 0x0F, 0x0F,
         0xE0, 0x1E, 0x07, 0xF0, 0x3C, 0x01, 0xF8, 0x3C, 0x00, 0xF8, 0x7C, 0x00, 0x78, 0x78, 0x00, 0x7C,
         0x78, 0x00, 0x7C, 0x78, 0x00, 0x7C, 0x78, 0x00, 0x7C, 0x7C, 0x00, 0x78, 0x3C, 0x00, 0x78, 0x1E,
         0x00, 0xF0, 0x1F, 0x01, 0xF0, 0x0F, 0xC7, 0xE0, 0x03, 0xFF, 0x80, 0x00, 0x7C, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00},
        {0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x00, 0x03, 0xFF, 0x80, 0x0F, 0xC7,
         0xC0, 0x0F, 0x01, 0xE0, 0x1E, 0x01, 0xE0, 0x3E, 0x00, 0xF0, 0x3C, 0x00, 0xF8, 0x3C, 0x00, 0xF8,
         0x7C, 0x00, 0x78, 0x7C, 0x00, 0x78, 0x7C, 0x00, 0x7C, 0x7C, 0x00, 0x7C, 0x7C, 0x00, 0x7C, 0x7C,
         0x00, 0x7C, 0x7C, 0x00, 0xFC, 0x3E, 0x00, 0xFC, 0x3E, 0x01, 0xFC, 0x1F, 0x03, 0xFC, 0x1F, 0x8F,
         0xFC, 0x0F, 0xFF, 0x7C, 0x03, 0xFC, 0x7C, 0x00, 0x00, 0xF8, 0x00, 0x00, 0xF8, 0x00, 0x00, 0xF8,
         0x00, 0x00, 0xF8, 0x00, 0x00, 0xF0, 0x00, 0x01, 0xF0, 0x1F, 0x01, 0xE0, 0x1F, 0x03, 0xE0, 0x1F,
         0x03, 0xC0, 0x1F, 0x07, 0x80, 0x0F, 0x9F, 0x00, 0x07, 0xFE, 0x00, 0x01, 0xF0, 0x00, 0x00, 0x00,
         0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00}

};
// lcd初始化
int lcd_init(void)
{
    lcdfd = open("/dev/fb0", O_RDWR); // 打开LCD设备文件
    if (lcdfd == -1)
    {
        perror("open lcd error");
        return -1;
    }

    // 将LCD设备内存映射到进程空间
    plcd = (int *)mmap(NULL, 800 * 480 * 4, PROT_READ | PROT_WRITE, MAP_SHARED, lcdfd, 0);
    if (plcd == MAP_FAILED)
    {
        perror("mmap lcd error");
        close(lcdfd);
        return -1;
    }

    return 0;
}

// 释放LCD资源
int lcd_uninit(void)
{
    if (plcd != MAP_FAILED)
    {
        munmap(plcd, 800 * 480 * 4); // 解除内存映射
    }
    close(lcdfd); // 关闭LCD设备文件
    return 0;
}

// 绘制单个像素点
int lcd_draw_point(int x, int y, int color)
{
    if (x < 0 || x >= 800 || y < 0 || y >= 480)
    {
        printf("指定画点的坐标超出屏幕范围\n");
        return -1;
    }

    *(plcd + y * 800 + x) = color; // 设置像素点颜色
}

// 绘制矩形
void lcd_draw_clear(int x0, int y0, int w, int h, int color)
{
    for (int x = x0; x < x0 + w; x++)
    {
        for (int y = y0; y < y0 + h; y++)
        {
            lcd_draw_point(x, y, color);
        }
    }
}
void lcd_draw_clear1(int x0, int y0, int w, int h, int color)
{
    for (int x = x0; x < x0 + w; x++)
    {
        lcd_draw_point(x, y0, color);
        lcd_draw_point(x, y0 + h - 1, color);
    }
    for (int y = y0; y < y0 + h; y++)
    {
        lcd_draw_point(x0, y, color);
        lcd_draw_point(x0 + w - 1, y, color);
    }
}

// 绘制圆形
void lcd_draw_circle(int x0, int y0, int radius, int color)
{
    for (int x = x0 - radius; x <= x0 + radius; x++)
    {
        for (int y = y0 - radius; y <= y0 + radius; y++)
        {
            if ((x - x0) * (x - x0) + (y - y0) * (y - y0) <= radius * radius)
            {
                lcd_draw_point(x, y, color);
            }
        }
    }
}

// 绘制四叶草
void lcd_draw_fourleafclover(void)
{
    int x0 = 400;     // 屏幕中心x坐标
    int y0 = 240;     // 屏幕中心y坐标
    int radius = 100; // 圆的半径

    // 绘制四个圆
    lcd_draw_circle(x0, y0 - radius, radius, 0x00FF00); // 上圆
    lcd_draw_circle(x0, y0 + radius, radius, 0x00FF00); // 下圆
    lcd_draw_circle(x0 - radius, y0, radius, 0x00FF00); // 左圆
    lcd_draw_circle(x0 + radius, y0, radius, 0x00FF00); // 右圆
}

void lcd_draw_word(int x0, int y0, int w, int h, char *dat)
{
    // 总共要显示：w * h个像素点
    // 按扫描的顺序给每个像素点进行编号，从0开始
    // 编号的范围：[0, w*h)

    int i; // 保存像素点的编号
    for (i = 0; i < w * h; i++)
    {
        // 解析第i个像素点
        int x, y; //(x, y)表示这个像素点在屏幕上的位置

        x = x0 + i % w;
        y = y0 + i / w;

        // 判断这个点在不在笔划上
        //  1. 这个像素点对应的取模后的数据在数组dat的哪个字节里面
        //  2. index 为这个像素点的数据在数组dat的下标
        //  3. bit为这个像素点在字节dat[index]哪个bit位上
        int index = i / 8;
        int bit = 7 - i % 8;

        if (dat[index] & (1 << bit))
        {
            // 在笔划上
            int color = 0xFF00; // 表示这个像素点要显示的颜色
            lcd_draw_point(x, y, color);
        }
    }
}

void lcd_draw_num(int x0, int y0, int num)
{
    int i = 0; // 保存已经显示了的数字的个数

    while (num)
    {
        lcd_draw_word(x0 - i * 24, y0, 24, 48, num_code[num % 10]);
        i++;

        num /= 10;
    }
}